<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Poster Finder</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <nav>
            <div class="logo">Movie Poster Finder</div>
            <div class="search-container">
                <input type="text" id="movieSearch" placeholder="Search for a movie...">
                <button id="searchButton"><i class="fas fa-search"></i></button>
            </div>
        </nav>
    </header>

    <main>
        <div id="suggestions"></div>
        <div id="posterContainer" style="display: none;">
            <div class="poster-wrapper">
                <img id="poster" src="" alt="Movie Poster">
                <div class="resolution-control">
                    <label for="resolutionSelect">Select Image Size:</label>
                    <select id="resolutionSelect">
                        <option value="100p">Small</option>
                        <option value="300p">Medium</option>
                        <option value="400p">Large</option>
                    </select>
                </div>
            </div>
            <div class="poster-info">
                <h2 id="movieTitle"></h2>
                <p id="movieYear"></p>
                <p id="movieRating"></p>
                <button id="downloadButton" class="btn">Download Poster</button>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Movie Poster Finder. All rights reserved.</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>


<script>
    $(document).ready(function() {
        let originalPosterSrc = '';

        $('#movieSearch').on('input', function() {
            let title = $(this).val();
            if (title.length > 2) {
                $.get('/search', { title: title }, function(data) {
                    $('#suggestions').empty().show();
                    data.forEach(function(movie) {
                        $('#suggestions').append('<div class="movie-item">' + movie.Title + ' (' + movie.Year + ')</div>');
                    });
                });
            } else {
                $('#suggestions').empty().hide();
            }
        });

        $(document).on('click', '.movie-item', function() {
            let movieInfo = $(this).text().match(/(.*) \((\d{4})\)/);
            let movieTitle = movieInfo[1];
            let movieYear = movieInfo[2];
            
            $.get('/poster', { title: movieTitle }, function(data) {
                if (data.poster) {
                    originalPosterSrc = data.poster;
                    $('#poster').attr('src', originalPosterSrc).show(); // Display the poster
                    $('#movieTitle').text(movieTitle);
                    $('#movieYear').text('Year: ' + movieYear);
                    $('#movieRating').text('IMDb Rating: ' + (data.rating || 'N/A'));
                    $('#posterContainer').show();
                    $('#downloadButton').show();
                } else {
                    alert('Poster not found!');
                }
            });
            
            $('#suggestions').empty().hide();
            $('#movieSearch').val(movieTitle);
        });

        // Update poster source based on selected resolution
        $('#resolutionSelect').on('change', function() {
            const selectedSize = $(this).val();  // Get selected size

            // Update the poster source based on the resolution
            if (originalPosterSrc) {
                let newSrc = originalPosterSrc.replace(/(SX|L|XL)(\d+)/g, function(match, prefix) {
                    // Change the prefix based on the selection
                    if (selectedSize === '100p') {
                        return 'SX300'; // Small
                    } else if (selectedSize === '300p') {
                        return 'L300'; // Medium
                    } else if (selectedSize === '400p') {
                        return 'XL400'; // Large
                    }
                    return match; // Return original if no match
                });

                console.log('Updated poster source:', newSrc); // Debugging line
                $('#poster').attr('src', newSrc);  // Update the image displayed
            }
        });

        // Directly download the adjusted size
        $('#downloadButton').on('click', function() {
            let link = document.createElement('a');
            const selectedSize = $('#resolutionSelect').val(); // Get the selected size

            // Construct the download URL based on the selected resolution
            let downloadSrc = originalPosterSrc.replace(/(SX|L|XL)(\d+)/g, function(match, prefix) {
                // Change the prefix based on the selection
                if (selectedSize === '100p') {
                    return 'SX300'; // Small
                } else if (selectedSize === '300p') {
                    return 'L300'; // Medium
                } else if (selectedSize === '400p') {
                    return 'XL400'; // Large
                }
                return match; // Return original if no match
            });

            console.log('Downloading from URL:', downloadSrc); // Log for debugging

            link.href = downloadSrc; // Set the link to the image source
            link.setAttribute('download', movieTitle + '.jpg');  // Set the download name
            document.body.appendChild(link);
            link.click(); // Trigger the download
            document.body.removeChild(link); // Clean up
        });
    });
</script>




</body>
</html>
